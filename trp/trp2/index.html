<html>
<head>
    <meta charset="utf-8">
    <style type="text/css">
        body {
            background-color: #CCCCCC;
        }
    </style>

    <script>
        function createBase(name, title_name, color, open, close){
            let title = document.createElement('a');
            title.id = name+'_title';
            title.style = 'cursor:pointer; user-select:none;';
            title.textContent = '▼ '+title_name;
            
            let inside = document.createElement('div');
            inside.id = name+'_inside';
            inside.style = 'display:none; clear:both; user-select:none;';
            inside.style.textIndent = '1em';

            title.addEventListener('click',function(){
                if(inside.style.display === 'none'){
                    inside.style.display = 'block';
                    title.textContent = '▲ '+title_name;

                    open(inside);
                }else{
                    inside.style.display = 'none';
                    title.textContent = '▼ '+title_name;
                    
                    close(inside);
                }
            });

            let parent = document.createElement('div');
            parent.id = name;
            parent.style.backgroundColor = color;
            parent.appendChild( title );
            parent.appendChild( inside );

            document.body.appendChild( parent );
        }
    </script>
</head>
<body>

<a href="https://undym.github.io/">前の</a>

<br>
<br>

<!-- trp10 -->
<script>
{   
    
    const MapData = {
        CLICK_START:[
                '',
                '',
                '',
                '',
                '',
                '',
                'C l i c k S t a r t',
                '',
                '',
                '',
                '',
                '',
                '',
        ],
        STAGE_0:[
                '                                ',
                '                                ',
                '                                ',
                '                                ',
                '                                ',
                '                                ',
                '                                ',
                '             *             <|   ',
                '             **             |   ',
                '********************   *****.***',
                '********************   *********',
                '********************************',
        ],
    };
    let init = false;

    let map = [];
    let dom = {
        map_parent:undefined,
        map:undefined,
        ball:undefined,
        ball_charge:undefined,
        clear:undefined,
    };

    let ball = {
        x:0.0,
        y:0.0,
        vec_x:0.0,
        vec_y:0.0,
        moving:false,
        charge:0.0,
        charging:false,
    };

    const BLOCK_SIZE = 8;
    const BALL_CHARGE_MAX = 20.0;

    let start = false;
    let run_timer;


    function resetMapDom(){
        while(dom.map_parent.firstChild){
            dom.map_parent.removeChild( dom.map_parent.firstChild );
        }

        dom.map_parent.appendChild( dom.ball );
    }

    function setMap(map_data){
        resetMapDom();

        map = map_data;

        dom.map = [];
        for(let y = 0; y < map.length; y++){
            let arr = [];
            for(let x = 0; x < map[y].length; x++){
                arr.push( document.createElement('div') );
                arr[x].textContent = map[y].substr(x,1);
                arr[x].style.position = 'absolute';
                arr[x].style.top  = (y * BLOCK_SIZE)+'px';
                arr[x].style.left = (x * BLOCK_SIZE)+'px';

                dom.map_parent.appendChild( arr[x] );
            }
            
            dom.map.push( arr );
        }

    }


    function reset(){
        start = false;
        dom.ball.textContent = '';
        setMap( MapData.CLICK_START );

        clearTimeout( run_timer );
    }


    function getSquareBlock(x,y){
        x = Math.floor(x);
        y = Math.floor(y);
        if(y >= 0 && y < map.length && x >= 0 && x < map[y].length){
            return map[y].substr(x,1);
        }
        return ' ';
    }


    function run(){
        if(ball.moving){
            let x = Math.floor( ball.x / BLOCK_SIZE );
            let y = Math.floor( ball.y / BLOCK_SIZE );

            if(getSquareBlock(x,y+1) !== '*'){
                ball.vec_y += 0.4;
                if(ball.vec_y >= 7){
                    ball.vec_y = 7;
                }
            }

            if(ball.vec_y > 0 && getSquareBlock(x,y+1) === '*'){
                ball.vec_y *= -0.5;

                if(Math.abs( ball.vec_x ) <= 0.1 && Math.abs( ball.vec_y ) <= 0.3){
                    ball.moving = false;
                }
            }
            
            if(
                   (ball.vec_x > 0 && getSquareBlock(x+1,y) === '*')
                || (ball.vec_x < 0 && getSquareBlock(x-1,y) === '*')
            ){
                ball.vec_x *= -0.95;
            }

            if(getSquareBlock(x,y) === '.'){
                dom.clear.textContent = 'クリア★';
            }

            ball.vec_x *= 0.95;
            
            ball.x += ball.vec_x;
            ball.y += ball.vec_y;
        }else{
            let charge_spd = BALL_CHARGE_MAX / 30;
            if(ball.charging){
                ball.charge += charge_spd;
                if(ball.charge >= BALL_CHARGE_MAX){
                    ball.charge = BALL_CHARGE_MAX;
                    ball.charging = false;
                }
            }else{
                ball.charge -= charge_spd;
                if(ball.charge <= 0.3){
                    ball.charge = 0.3;
                    ball.charging = true;
                }
            }

            dom.ball_charge.textContent = (()=>{
                let sp = BALL_CHARGE_MAX / 10;
                let str = '';
                for(let i = 0; i * sp <= ball.charge; i++){
                    str += '*';
                }
                return str;
            })();
        }

        dom.ball.style.left = Math.floor( ball.x )+'px';
        dom.ball.style.top  = Math.floor( ball.y )+'px';

        run_timer = setTimeout( run ,32 );
    }


    createBase('trp10','trp_story_10','#d0ffd7',(inside)=>{
        if(!init){
            init = true;

            dom.ball = document.createElement('div');
            dom.ball.style.position = 'absolute';
            dom.ball.style.fontSize = '8px';
            
            inside.appendChild((()=>{
                dom.ball_charge = document.createElement('div');
                dom.ball_charge.textContent = '　';//dummy
                return dom.ball_charge;
            })());
            inside.appendChild((()=>{
                dom.map_parent = document.createElement('div');
                dom.map_parent.style.position = 'relative';

                dom.map_parent.appendChild( document.createElement('br') );
                dom.map_parent.appendChild( document.createElement('br') );
                dom.map_parent.appendChild( document.createElement('br') );
                dom.map_parent.appendChild( document.createElement('br') );
                dom.map_parent.appendChild( document.createElement('br') );

                return dom.map_parent;
            })());
            inside.appendChild((()=>{
                dom.clear = document.createElement('div');
                dom.clear.textContent = '　';//dummy
                return dom.clear;
            })());
            inside.appendChild((()=>{//背景確保用
                let div = document.createElement('div');
                for(let i = 0; i < 8; i++){
                    div.appendChild( document.createElement('br') );
                }

                return div;
            })());

            inside.addEventListener('click',()=>{
                if(!start){
                    start = true;

                    dom.ball.textContent = '@';
                    ball.x = 0;
                    ball.y = 0;
                    ball.vec_x = 0;
                    ball.vec_y = 0;
                    ball.charge = 0;
                    ball.moving = true;

                    dom.ball_charge.textContent = '　';

                    setMap( MapData.STAGE_0 );

                    run();
                    return;
                }


                if(!ball.moving){
                    ball.moving = true;
                    let rad = -Math.PI / 8;
                    ball.vec_x = Math.cos(rad) * ball.charge;
                    ball.vec_y = Math.sin(rad) * ball.charge;
                }
            });
        }

        reset();
    },(inside)=>{
        dom.clear.textContent = '　';
        clearTimeout( run_timer );
    });
}
</script>

<br>

<!-- trp11 -->
<script>
{   
    
    const MapData = {
        CLICK_START:[
                '',
                '',
                '',
                '',
                '',
                '',
                'C l i c k S t a r t',
                '',
                '',
                '',
                '',
                '',
                '',
        ],
        STAGE_0:[
                '                                                              ',
                '                                                              ',
                '                                  `                           ',
                '        *           *                                    <|   ',
                '        *           *                                     |  *',
                '********************************* ************************.***',
                '********************************* ****************************',
                '********************************* ****************************',
        ],
    };
    let init = false;

    let map = [];
    let dom = {
        map_parent:undefined,
        map:undefined,
        ball:undefined,
        ball_charge:undefined,
        clear:undefined,
    };

    let ball = {
        x:0.0,
        y:0.0,
        vec_x:0.0,
        vec_y:0.0,
        moving:false,
        charge:0.0,
        charging:false,
    };

    const BLOCK_SIZE = 8;
    const BALL_CHARGE_MAX = 20.0;
    const BALL_CHARGE_GAGE = '**********';

    let start = false;
    let run_timer;
    let tengu = -1;
    let run_count = 0;


    function resetMapDom(){
        while(dom.map_parent.firstChild){
            dom.map_parent.removeChild( dom.map_parent.firstChild );
        }

        dom.map_parent.appendChild( dom.ball );
    }

    function setMap(map_data){
        resetMapDom();

        map = map_data;

        dom.map = [];
        for(let y = 0; y < map.length; y++){
            let arr = [];
            for(let x = 0; x < map[y].length; x++){
                arr.push( document.createElement('div') );
                arr[x].textContent = map[y].substr(x,1);
                arr[x].style.position = 'absolute';
                arr[x].style.top  = (y * BLOCK_SIZE)+'px';
                arr[x].style.left = (x * BLOCK_SIZE)+'px';

                dom.map_parent.appendChild( arr[x] );
            }
            
            dom.map.push( arr );
        }

    }


    function reset(){
        start = false;
        dom.ball.textContent = '';
        setMap( MapData.CLICK_START );

        clearTimeout( run_timer );
    }


    function getSquareBlock(x,y){
        x = Math.floor(x);
        y = Math.floor(y);
        if(y >= 0 && y < map.length && x >= 0 && x < map[y].length){
            return map[y].substr(x,1);
        }
        return ' ';
    }


    function run(){
        run_count++;

        if(ball.moving){
            let x = Math.floor( ball.x / BLOCK_SIZE );
            let y = Math.floor( ball.y / BLOCK_SIZE );

            if(getSquareBlock(x,y+1) !== '*'){
                ball.vec_y += 0.4;
                if(ball.vec_y >= 7){
                    ball.vec_y = 7;
                }
            }

            if(ball.vec_y > 0 && getSquareBlock(x,y+1) === '*'){
                // ball.y = y * BLOCK_SIZE;
                ball.vec_y *= -0.3;

            }
            
            if(
                   (ball.vec_x > 0 && getSquareBlock(x+1,y) === '*')
                || (ball.vec_x < 0 && getSquareBlock(x-1,y) === '*')
            ){
                ball.vec_x *= -0.95;
            }

            if(getSquareBlock(x,y) === '`'){
                tengu = dom.map[0].length - 1;
                dom.map[y][x].textContent = ' ';
            }

            if(getSquareBlock(x,y) === '.'){
                dom.clear.textContent = 'クリア★';
            }

            ball.vec_x *= 0.95;
            
            ball.x += ball.vec_x;
            ball.y += ball.vec_y;
            
            if(Math.abs( ball.vec_x ) <= 0.1 && Math.abs( ball.vec_y ) <= 0.3){
                ball.moving = false;
            }
        }else{
            let charge_spd = BALL_CHARGE_MAX / 30;
            if(ball.charging){
                ball.charge += charge_spd;
                if(ball.charge >= BALL_CHARGE_MAX){
                    ball.charge = BALL_CHARGE_MAX;
                    ball.charging = false;
                }
            }else{
                ball.charge -= charge_spd;
                if(ball.charge <= 0){
                    ball.charge = 0;
                    ball.charging = true;
                }
            }

            dom.ball_charge.textContent = (()=>{
                let num = Math.floor( BALL_CHARGE_GAGE.length * ball.charge / BALL_CHARGE_MAX );
                if(num === 0){return '　';}
                return BALL_CHARGE_GAGE.substr(0,num);
            })();
        }

        dom.ball.style.left = Math.floor( ball.x )+'px';
        dom.ball.style.top  = Math.floor( ball.y )+'px';
        
        if(tengu >= 0 && run_count % 3 === 0){
            if(tengu < dom.map[0].length - 1){dom.map[0][tengu+1].textContent = ' ';}

            dom.map[0][tengu].textContent = '👺';

            tengu --;
            if(tengu < 0){
                dom.map[0][0].textContent = ' ';
            }
        }

        run_timer = setTimeout( run ,32 );
    }


    createBase('trp11','trp_story_11','#51d1c0',(inside)=>{
        if(!init){
            init = true;

            dom.ball = document.createElement('div');
            dom.ball.style.position = 'absolute';
            dom.ball.style.fontSize = '8px';
            
            inside.appendChild((()=>{
                dom.ball_charge = document.createElement('div');
                dom.ball_charge.textContent = '　';//dummy
                return dom.ball_charge;
            })());
            inside.appendChild((()=>{
                dom.map_parent = document.createElement('div');
                dom.map_parent.style.position = 'relative';

                dom.map_parent.appendChild( document.createElement('br') );
                dom.map_parent.appendChild( document.createElement('br') );
                dom.map_parent.appendChild( document.createElement('br') );
                dom.map_parent.appendChild( document.createElement('br') );
                dom.map_parent.appendChild( document.createElement('br') );

                return dom.map_parent;
            })());
            inside.appendChild((()=>{
                dom.clear = document.createElement('div');
                dom.clear.textContent = '　';//dummy
                return dom.clear;
            })());
            inside.appendChild((()=>{//背景確保用
                let div = document.createElement('div');
                for(let i = 0; i < 8; i++){
                    div.appendChild( document.createElement('br') );
                }

                return div;
            })());

            inside.addEventListener('click',()=>{
                if(!start){
                    start = true;

                    dom.ball.textContent = '@';
                    ball.x = 0;
                    ball.y = 0;
                    ball.vec_x = 0;
                    ball.vec_y = 0;
                    ball.charge = 0;
                    ball.moving = true;

                    dom.ball_charge.textContent = '　';

                    setMap( MapData.STAGE_0 );

                    run();
                    return;
                }


                if(!ball.moving){
                    ball.moving = true;
                    let rad = -Math.PI / 8;
                    ball.vec_x = Math.cos(rad) * ball.charge;
                    ball.vec_y = Math.sin(rad) * ball.charge;
                }
            });
        }

        reset();
    },(inside)=>{
        dom.clear.textContent = '　';
        clearTimeout( run_timer );
    });
}
</script>

<br>

<!-- trp12 -->
<script>
{
    let init = false;

    createBase('trp12','trp_story_12','#d6cdcd',(inside)=>{
        if(!init){
            init = true;
            
            inside.appendChild((()=>{
                let ret = document.createElement('div');
                ret.textContent = 'クリア★';
                ret.style.display = 'inline-block';
                ret.style.transform = 'rotate(10deg)';
                return ret;
            })());

        }

    },(inside)=>{
    });
}
</script>

<br>

<!-- trp13 -->
<script>
    {
        let init = false;
        let clear;
        let deg = 0;
        let run_timer;
    
        function run(){
            clear.style.transform = 'rotate('+deg+'deg)';
            deg += 25;
            run_timer = setTimeout( run ,36 );
        }
    
        createBase('trp13','trp_story_13','#ff9191',(inside)=>{
            if(!init){
                init = true;
                
                inside.appendChild((()=>{
                    clear = document.createElement('div');
                    clear.textContent = 'クリア★';
                    clear.style.display = 'inline-block';
                    clear.style.fontSize = '200%';
                    return clear;
                })());
    
            }
            
            run();
        },(inside)=>{
            clearTimeout( run_timer );
        });
    }
</script>

<br>

<!-- trp14 -->
<script>
    {
        const BACKGROUND_COLOR = '#c548ff';
        const START_SIZE = 30;
        let size = START_SIZE;

        let init = false;
        let center;
        let right;
        let clears = [];
        let run_timer;
        let mouse = {x:0,y:0};

        class Clear{
            constructor(){
                this.dom = undefined;
                this.x = 0.0;
                this.y = 0.0;
                let vec = 4;
                this.vec_x = -vec + Math.random() * vec * 2;
                this.vec_y = -0.1 - Math.random() * 3;
                this.shake = 0;
                this.shake_r = Math.random() * 4;
                this.shake_spd = Math.random() * 0.3;
            }

            setPos(x,y){
                this.x = x;
                this.y = y;

            }
        }

        function reset(){
            setBomSize( START_SIZE );
            center.textContent = '💣';
            clearClears();
        }

        function setBomSize(value){
            size = value;
            center.style.fontSize = size+'px';
            right.style.fontSize = size+'px';
        }

        function run(){
            for(let i = 0; i < clears.length; i++){
                let c = clears[i];

                c.x += c.vec_x;
                c.y += c.vec_y;

                let x = c.vec_y < 0 ? c.x : c.x + Math.sin( c.shake ) * c.shake_r;
                c.dom.style.left = x+'%';
                c.dom.style.top  = c.y+'%';

                c.vec_x *= 0.95;
                c.vec_y += 0.13;
                if(c.vec_y > 1){
                    c.vec_y = 1;
                }
                if(c.vec_y > 0){
                    c.shake += c.shake_spd;
                }
            }

            run_timer = setTimeout( run ,36 );
        }

        function clearClears(){
            for(let i = 0; i < clears.length; i++){
                document.body.removeChild( clears[i].dom );
            }

            clears = [];
        }
    
        createBase('trp14','trp_story_14',BACKGROUND_COLOR,(inside)=>{
            if(!init){
                init = true;
                
                inside.appendChild((()=>{
                    let lc = document.createElement('div');
                    lc.style.cssFloat = 'left';
                    lc.style.width = '67%';
                    lc.style.backgroundColor = BACKGROUND_COLOR;

                    lc.appendChild((()=>{
                        let left = document.createElement('div');
                        left.style.cssFloat = 'left';
                        left.style.width = '50%';
                        return left;
                    })());
                    lc.appendChild((()=>{
                        center = document.createElement('div');
                        center.style.cssFloat = 'right';
                        center.style.width = '50%';
                        center.style.textAlign = 'center';

                        center.addEventListener('click',()=>{
                            setBomSize( Math.floor( size * 1.1 + 1 ) );

                            if(size >= 200){
                                reset();
                                
                                for(let i = 0; i < 100; i++){
                                    let c = new Clear();
                                    c.dom = document.createElement('span');
                                    c.dom.textContent = 'クリア★';
                                    c.dom.style.position = 'fixed';
                                    c.dom.style.textAlign = 'center';
                                    c.x = Math.floor( mouse.x / window.innerWidth * 100 );
                                    c.y = Math.floor( mouse.y / window.innerHeight * 100 );

                                    // console.log(c.x+','+c.y);
                                    
                                    c.dom.style.left = c.x+'%';
                                    c.dom.style.top  = c.y+'%';

                                    clears.push( c );
                                    document.body.appendChild( c.dom );
                                }
                                
                                clearTimeout( run_timer );
                                run();
                            }
                        });
                        center.addEventListener('mousemove',(ev)=>{
                            mouse.x = ev.pageX;
                            mouse.y = ev.pageY;
                            // console.log('/');
                            // console.log( mouse.x+','+mouse.y );
                            // console.log( window.innerWidth+','+window.innerHeight );
                        });
                        return center;
                    })());
                    return lc;
                })());
                inside.appendChild((()=>{
                    right = document.createElement('div');
                    right.style.cssFloat = 'right';
                    right.style.width = '33%';
                    right.style.backgroundColor = BACKGROUND_COLOR;
                    right.textContent = '　';
                    return right;
                })());
            }


            reset();
        },(inside)=>{
            reset();
            
            clearTimeout( run_timer );
        });
    }
</script>

<br>

<span style="color:#c548ff;"></span>
<br>
<br>
<br>
<br>
<br>
<br>
<br>

</body>

</html>