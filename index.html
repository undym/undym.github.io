<html>

<head>
    <style type="text/css">
        body {
            background-color: #CCCCCC;
        }
    </style>
    
    <script>
        function createBase(name, title_name, color, init, fini){
            let title = document.createElement('a');
            title.id = name+'_title';
            title.style = 'cursor:pointer; user-select:none;';
            title.textContent = '▼ '+title_name;
            
            let open = document.createElement('div');
            open.id = name+'_open';
            open.style = 'display:none; clear:both; cursor:pointer; user-select:none;';

            title.addEventListener('click',function(){
                if(open.style.display === 'none'){
                    open.style.display = 'block';
                    title.textContent = '▲ '+title_name;

                    init();
                }else{
                    open.style.display = 'none';
                    title.textContent = '▼ '+title_name;
                    
                    fini();
                }
            });

            let parent = document.createElement('div');
            parent.id = name;
            parent.style.backgroundColor = color;
            parent.appendChild( title );
            parent.appendChild( open );

            document.body.appendChild( parent );
        }


        function createBase2(name, title_name, color, init, fini){
            let title = document.createElement('a');
            title.id = name+'_title';
            title.style = 'cursor:pointer; user-select:none;';
            title.textContent = '▼ '+title_name;
            
            let open = document.createElement('div');
            open.id = name+'_open';
            open.style = 'display:none; clear:both; user-select:none;';
            open.style.textIndent = '1em';

            title.addEventListener('click',function(){
                if(open.style.display === 'none'){
                    open.style.display = 'block';
                    title.textContent = '▲ '+title_name;

                    init(open);
                }else{
                    open.style.display = 'none';
                    title.textContent = '▼ '+title_name;
                    
                    fini(open);
                }
            });

            let parent = document.createElement('div');
            parent.id = name;
            parent.style.backgroundColor = color;
            parent.appendChild( title );
            parent.appendChild( open );

            document.body.appendChild( parent );
        }
    </script>
</head>

<body>
    <a href="https://undym.github.io/trp/trp2/">次の</a>
    
    <br>
    <br>
    
    <!-- trp2 -->
    クリア
    <!-- /trp2 -->

    <br>
    <br>

    <!-- trp3 -->
    <div style="background-color:#ffcc99;">
        <!-- 折り畳み展開ポインタ -->
        <a id="trp3_title" style="cursor:pointer;" onclick="obj=document.getElementById('trp3_open').style; obj.display=(obj.display=='none')?'block':'none';">
            trp3_dummy
            <script>
                var trp3_title_1 = '▼ trp_story_3';
                var trp3_title_2 = '▲ trp_story_3';
                addEventListener('load' ,function(){
                    document.getElementById('trp3_title').innerHTML = trp3_title_1;
                })
                document.getElementById('trp3_title').addEventListener('click' ,function(){
                    var elm = document.getElementById('trp3_title');
                    if(elm.innerHTML === trp3_title_1)  {elm.innerHTML = trp3_title_2;}
                    else                                {elm.innerHTML = trp3_title_1;}
                })
            </script>
        </a>
        <!--// 折り畳み展開ポインタ -->
            
        <!-- 折り畳まれ部分 -->
        <div id="trp3_open" style="display:none;clear:both;">
        　クリア
        </div>
        <!--ここの部分が折りたたまれる＆展開される部分になります。
        自由に記述してください。-->  
    </div>
    <!-- /trp3 -->

    <br>

    <!-- trp4 -->
    <div style="background-color:#33aa77;">
        <a id="trp4_title" style="cursor:pointer;" onclick="obj=document.getElementById('trp4_open').style; obj.display=(obj.display=='none')?'block':'none';">
            trp4_dummy
            <script>
                var trp4_title_1 = '▼ trp_story_4';
                var trp4_title_2 = '▲ trp_story_4';
                addEventListener('load' ,function(){
                    document.getElementById('trp4_title').innerHTML = trp4_title_1;
                })
                document.getElementById('trp4_title').addEventListener('click' ,function(){
                    var elm = document.getElementById('trp4_title');
                    if(elm.innerHTML === trp4_title_1)  {elm.innerHTML = trp4_title_2;}
                    else                                {elm.innerHTML = trp4_title_1;}
                })
            </script>
        </a>
        
        <div id="trp4_open"  style="display:none;clear:both;">
            <a>　</a><!-- 全角スペース -->
            <a style="cursor:pointer;" onclick="innerHTML='ク'">■</a>
            <a style="cursor:pointer;" onclick="innerHTML='リ'">■</a>
            <a style="cursor:pointer;" onclick="innerHTML='ア'">■</a>
        </div>
    </div>
    <!-- /trp4 -->

    <br>

    <!-- trp5 -->
    <div style="background-color:#00cccc;">
        <a id="trp5_title" style="cursor:pointer;" onclick="obj=document.getElementById('trp5_open').style; obj.display=(obj.display=='none')?'block':'none';">
            trp5_dummy
            <script>
                var trp5_titles = ['▼ trp_story_5','▲ trp_story_5'];
                addEventListener('load' ,function(){
                    document.getElementById('trp5_title').innerHTML = trp5_titles[0];
                })
                document.getElementById('trp5_title').addEventListener('click' ,function(){
                    var elm = document.getElementById('trp5_title');
                    if(elm.innerHTML === trp5_titles[0]){elm.innerHTML = trp5_titles[1];}
                    else                                {elm.innerHTML = trp5_titles[0];}
                })
            </script>
        </a>
        
        <div id="trp5_open"  style="display:none;clear:both;">
            <script>
                var trp5_slot = ['ク','リ','ア'];
                var trp5_slot_len = 3;
                var trp5_slot_id = [];
                var trp5_slot_num = [];
                var trp5_rolling = [];

                function slotAction(){
                    var rolling_i = -1;
                    for(let i = 0; i < trp5_slot_len; i++){
                        if(trp5_rolling[i]){
                            rolling_i = i;
                            break;
                        }
                    }

                    if(rolling_i === -1){
                        function slot(i){
                            return document.getElementById(trp5_slot_id[i]).innerHTML;
                        }
                        if(slot(0) === 'ク' && slot(1) === 'リ' && slot(2) === 'リ'){
                            if(document.getElementById('trp5_invisible_slot_id').innerHTML === 'ン'){
                                document.getElementById('trp5_invisible_slot_id').innerHTML = '';
                            }else{
                                document.getElementById('trp5_invisible_slot_id').innerHTML = "ン";
                                return;
                            }
                        }
                        if(slot(0) === 'ク' && slot(1) === 'リ' && slot(2) === 'ア'){
                            if(document.getElementById('trp5_invisible_slot_id').innerHTML === '★'){
                                document.getElementById('trp5_invisible_slot_id').innerHTML = '';
                            }else{
                                document.getElementById('trp5_invisible_slot_id').innerHTML = "★";
                                return;
                            }
                        }

                        for(var i = 0; i < trp5_slot_len; i++){
                            trp5_rolling[i] = true;
                        }
                    }else{
                        trp5_rolling[ rolling_i ] = false;
                    }
                }
                
                document.write('<div onclick="slotAction();" style="cursor:pointer;user-select:none;" onCopy="return false;">');
                document.write('<br>');
                document.write('　');
                for(let i = 0; i < trp5_slot_len; i++){
                    trp5_slot_id.push('trp5_slot'+i);
                    trp5_slot_num.push(i % trp5_slot.length);
                    trp5_rolling.push(true);
                    document.write('<span id='+trp5_slot_id[i]+'>dummy</span>');
                }
                document.write('<span id="trp5_invisible_slot_id"></span>');
                document.write('<br>');
                document.write('　');
                document.write('</div>');

                function trp5_roll(){
                    for(var i = 0; i < trp5_slot_len; i++){
                        if(trp5_rolling[i]){
                            trp5_slot_num[i] = (trp5_slot_num[i]+1) % trp5_slot.length;

                            document.getElementById(trp5_slot_id[i]).innerHTML = trp5_slot[ trp5_slot_num[i] ];
                        }
                    }
                }
                setInterval(trp5_roll ,50);
            </script>
        </div>
    </div>
    <!-- /trp5 -->

    <br>

    <!-- trp6 -->
    <div style="background-color:#e44ea0;">
        <a id="trp6_title" style="cursor:pointer;user-select:none;" onclick="obj=document.getElementById('trp6_open').style; obj.display=(obj.display=='none')?'block':'none';">
            trp6_dummy
            <script>
                var trp6_titles = ['▼ trp_story_6','▲ trp_story_6'];
                var trp6_titles_index = 0;
                addEventListener('load' ,function(){
                    document.getElementById('trp6_title').innerHTML = trp6_titles[0];
                })
                document.getElementById('trp6_title').addEventListener('click' ,function(){
                    document.getElementById('trp6_title').innerHTML = trp6_titles[ ++trp6_titles_index % trp6_titles.length ];
                })
            </script>
        </a>
        
        <div id="trp6_open" style="display:none;clear:both;">
            <script>
                var trp6_x_len = 8;
                var trp6_y_len = 8;
                var trp6_squares = [];
                var trp6_squares_id = [];
                var trp6_block = '■';
                var trp6_air = '☆';
                var trp6_clear_indexes = [
                     [0,0]//y,x
                    ,[0,0]
                    ,[0,0]
                ];

                for(let y = 0; y < trp6_y_len; y++){
                    let line = [];
                    let ids = [];
                    for(let x = 0; x < trp6_x_len; x++){
                        line.push( trp6_block );
                        let id_num = y * trp6_x_len + x;
                        ids.push( 'trp6_square_id'+id_num );
                    }
                    trp6_squares.push( line );
                    trp6_squares_id.push( ids );
                }
                {
                    let y = Math.floor( Math.random() * trp6_y_len );
                    let x = Math.floor( Math.random() * trp6_x_len );
                    trp6_squares[y][x] = trp6_air;
                }
                {
                    let phase = 0;
                    while(true){
                        let y = Math.floor( Math.random() * trp6_y_len );
                        let x = Math.floor( Math.random() * trp6_x_len );

                        if(trp6_squares[y][x] === trp6_block){
                            if(phase === 0){
                                trp6_squares[y][x] = 'ク';
                                trp6_clear_indexes[0] = [y,x];
                            }else if(phase === 1){
                                trp6_squares[y][x] = 'リ';
                                trp6_clear_indexes[1] = [y,x];
                            }else if(phase === 2){
                                trp6_squares[y][x] = 'ア';
                                trp6_clear_indexes[2] = [y,x];
                            }else{
                                break;
                            }

                            phase++;
                        }
                    }   
                }

                function trp6_drawSquare(y,x){
                    document.getElementById( trp6_squares_id[y][x] ).innerHTML = trp6_squares[y][x];
                }

                function trp6_drawSquares(){
                    for(let y = 0; y < trp6_squares.length; y++){
                        for(let x = 0; x < trp6_squares[y].length; x++){
                            trp6_drawSquare(y,x);
                        }
                    }
                }

                function trp6_clickSquare(y,x){
                    let add = [
                         [-1, 0]//y,x
                        ,[ 0, 1]
                        ,[ 1, 0]
                        ,[ 0,-1]
                    ];
                    for(let i = 0; i < add.length; i++){
                        let _y = y + add[i][0];
                        let _x = x + add[i][1];
                        if(_y < 0 || _y >= trp6_squares.length || _x < 0 || _x >= trp6_squares[_y].length){continue;}

                        let square = trp6_squares[_y][_x];
                        if(square === trp6_air){
                            trp6_squares[_y][_x] = trp6_squares[y][x];
                            trp6_squares[y][x] = trp6_air;
                            
                            trp6_drawSquare(y,x);
                            trp6_drawSquare(_y,_x);

                            if(trp6_squares[_y][_x] === 'ク'){trp6_clear_indexes[0] = [_y,_x];}
                            if(trp6_squares[_y][_x] === 'リ'){trp6_clear_indexes[1] = [_y,_x];}
                            if(trp6_squares[_y][_x] === 'ア'){trp6_clear_indexes[2] = [_y,_x];}

                            if(trp6_squares[_y][_x] !== trp6_block){
                                trp6_checkClear();
                            }

                            break;
                        }
                    }
                }

                function trp6_checkClear(){
                    let ku = trp6_clear_indexes[0];
                    let ri = trp6_clear_indexes[1];
                    let a  = trp6_clear_indexes[2];

                    let clear = function(){
                        document.getElementById('trp6_invisible_clear_id').innerHTML = 'クリア★';
                    };
                    //クリア
                    if(ri[0] === ku[0] && ri[1] === ku[1]+1 && a[0] === ku[0] && a[1] === ku[1]+2){
                        clear();
                        return;
                    }
                    //ク＿＿
                    //リ＿＿
                    //ア＿＿
                    if(ri[0] === ku[0]+1 && ri[1] === ku[1] && a[0] === ku[0]+2 && a[1] === ku[1]){
                        clear();
                        return;
                    }
                    //ク＿＿
                    //＿リ＿
                    //＿＿ア
                    if(ri[0] === ku[0]+1 && ri[1] === ku[1]+1 && a[0] === ku[0]+2 && a[1] === ku[1]+2){
                        clear();
                        return;
                    }
                }
                
                document.write('<div style="cursor:pointer;user-select:none;">');
                document.write('<br>');
                for(let y = 0; y < trp6_squares.length; y++){
                    for(let x = 0; x < trp6_squares[y].length; x++){
                        let onclick = 'onclick="trp6_clickSquare('+y+','+x+');"';
                        document.write('<span id='+trp6_squares_id[y][x]+' '+onclick+'>dummy</span>');
                    }
                    document.write('<br>');
                }
                document.write('<br>');
                document.write('<span id="trp6_invisible_clear_id"></span>');
                document.write('　');
                document.write('</div>');


                trp6_drawSquares();

            </script>
        </div>
    </div>
    <!-- /trp6 -->

    <br>
    
    <!-- trp7 -->
    <div style="background-color:#88c7aa;">
        <a id="trp7_title" style="cursor:pointer;user-select:none;" 
            onclick="obj=document.getElementById('trp7_open').style;obj.display=(obj.display=='none')?'block':'none';"
        >
            trp7_dummy
            <script>
                var trp7_titles = ['▼ trp_story_7','▲ trp_story_7'];
                var trp7_title_id = document.getElementById('trp7_title');
                addEventListener('load' ,function(){
                    trp7_title_id.innerHTML = trp7_titles[0];
                })
                trp7_title_id.addEventListener('click' ,function(){
                    if(trp7_title_id.innerHTML === trp7_titles[0])  {trp7_title_id.innerHTML = trp7_titles[1];}
                    else                                            {trp7_title_id.innerHTML = trp7_titles[0];}
                })
            </script>
        </a>
        
        <div id="trp7_open" style="display:none;clear:both;cursor:pointer;">
            <span style="color:#88c7aa;">　クリア</span>
        </div>
    </div>
    <!-- /trp7 -->

    <br>
    
    <!-- trp7a -->
    <div style="background-color:#AAAA00;">
        <a id="trp7a_title" style="cursor:pointer;user-select:none;" >
            trp7a_dummy
            <script>
                var trp7a_titles = ['▼ trp_story_7a','▲ trp_story_7a'];
                var trp7a_title_id = document.getElementById('trp7a_title');
                var trp7a_original_title = document.title;
                addEventListener('load' ,function(){
                    trp7a_title_id.innerHTML = trp7a_titles[0];
                })
                trp7a_title_id.addEventListener('click' ,function(){
                    if(trp7a_title_id.innerHTML === trp7a_titles[0])  {
                        trp7a_title_id.innerHTML = trp7a_titles[1];
                        document.title = 'クリア';
                    }else{
                        trp7a_title_id.innerHTML = trp7a_titles[0];
                        document.title = trp7a_original_title;
                    }
                })
            </script>
        </a>
    </div>
    <!-- /trp7a -->

    <br>

    <!-- trp7b -->
    <script>
        let trp7b_clear = document.createElement('span');
            trp7b_clear.textContent = '　クリア';
            trp7b_clear.style.fontSize = '1000%';
        createBase('trp7b','trp_story_7b','#b10808',()=>{} ,()=>{});
        document.getElementById('trp7b_open').appendChild( trp7b_clear );
    </script>

    <br>

    <!-- trp7c -->
    <script>
        let trp7c_id =
            [
                'trp3_title',
                'trp4_title',
                'trp5_title',
                'trp6_title',
                'trp7_title',
                'trp7a_title',
                'trp7b_title',
            ];
        let trp7c_text_bak = [];
        createBase('trp7c','trp_story_7c','#616161',()=>{
            let clear = '▶ クリア★';
            trp7c_text_bak = [];
            for(let i = 0; i < trp7c_id.length; i++){
                let elm = document.getElementById(trp7c_id[i]);
                trp7c_text_bak.push( elm.innerHTML );
                elm.innerHTML = clear;
            }
        } ,()=>{
            for(let i = 0; i < trp7c_id.length; i++){
                document.getElementById(trp7c_id[i]).innerHTML = trp7c_text_bak[i];
            }
        });
    </script>
    
    <br>

    <!-- trp7d -->
    <script>
        let trp7d_init = false;
        createBase('trp7d','trp_story_7d','#8d7ae0',()=>{
            if(trp7d_init){return;}
            trp7d_init = true;

            let invisible_clear_elm = document.createElement('span');
            
            let x_len = 30;
            let y_len = 10;
            let strings = [];
            let clear = ['ク','リ','ア'];
            for(let y = 0; y < y_len; y++){
                let arr = [];
                for(let x = 0; x < x_len; x++){
                    let index = Math.floor( Math.random() * clear.length );
                    arr.push( clear[index] );
                }
                strings.push( arr );
            }
            for(let y = 0; y < y_len; y++){
                for(let x = 0; x < x_len-2; x++){
                    if(strings[y][x] === 'ク' && strings[y][x+1] === 'リ' && strings[y][x+2] === 'ア'){
                        strings[y][x] = '★';
                        continue;
                    }
                    if(y < y_len-2){
                        //ク＿＿
                        //リ＿＿
                        //ア＿＿
                        if(strings[y][x] === 'ク' && strings[y+1][x] === 'リ' && strings[y+2][x] === 'ア'){
                            strings[y][x] = '★';
                            continue;
                        }
                        //ク＿＿
                        //＿リ＿
                        //＿＿ア
                        if(strings[y][x] === 'ク' && strings[y+1][x+1] === 'リ' && strings[y+2][x+2] === 'ア'){
                            strings[y][x] = '★';
                            continue;
                        }
                    }
                }
            }

            let clear_x = Math.floor( Math.random() * (x_len-2) );
            let clear_y = Math.floor( Math.random() * y_len );

            strings[clear_y][clear_x]   = 'ク';
            strings[clear_y][clear_x+1] = 'リ';
            strings[clear_y][clear_x+2] = 'ア';

            let parent = document.createElement('span');
            for(let y = 0; y < y_len; y++){
                let str = '';
                for(let x = 0; x < x_len; x++){
                    str += strings[y][x];
                }

                if(y === clear_y){
                    let line1 = document.createElement('span');
                    line1.textContent = str.substring(0,clear_x);
                    parent.appendChild( line1 );
                    
                    let clear_elm = document.createElement('span');
                    clear_elm.textContent = str.substring(clear_x ,clear_x+3);
                    clear_elm.addEventListener('click',()=>{
                        invisible_clear_elm.textContent = 'クリア★';
                    });
                    parent.appendChild( clear_elm );

                    let line2 = document.createElement('span');
                    line2.textContent = str.substring(clear_x+3,str.length);
                    parent.appendChild( line2 );

                    parent.appendChild( document.createElement('br') );
                }else{
                    let line = document.createElement('span');
                    line.textContent = str;
                    parent.appendChild( line );
                    parent.appendChild( document.createElement('br') );
                }
            }

            parent.appendChild( document.createElement('br') );
            parent.appendChild( invisible_clear_elm );

            document.getElementById('trp7d_open').appendChild( parent );
        } ,()=>{});
    </script>

    <br>

    <!-- trp7e -->
    <script>
        let trp7e_init;
        createBase('trp7e','trp_story_7e','f0b616',()=>{
            if(trp7e_init){return;}
            trp7e_init = true;
            
            let invisible_clear_elm = document.createElement('span');
            let input = document.createElement('input');
            let btn = document.createElement('button');
            btn.textContent = '実行';
            btn.addEventListener('click',()=>{
                if(     (input.value.indexOf('クリア') !== -1)
                    ||  (input.value.indexOf('くりあ') !== -1)
                    ||  (input.value.toLowerCase().indexOf('clear') !== -1)
                ){
                    invisible_clear_elm.textContent = 'クリア★';
                }
            });
            let base = document.getElementById('trp7e_open');
            base.appendChild( input );
            base.appendChild( btn );
            base.appendChild( document.createElement('br') );
            base.appendChild( invisible_clear_elm );
            base.appendChild( document.createElement('br') );

        } ,()=>{
        });
    </script>

    <br>

    <!-- trp7f -->
    <script>
        let trp7f_str = '　クリア★';
        let trp7f_elm = document.createElement('span');
        createBase('trp7f','trp_story_7f','#996a2c'
            ,()=>{
                if(trp7f_elm.textContent.length < trp7f_str.length){
                    trp7f_elm.textContent = trp7f_str.substring(0 ,trp7f_elm.textContent.length+1);
                }
            },()=>{
            });
        document.getElementById('trp7f_open').appendChild( trp7f_elm );
    </script>

    <br>

    <!-- trp7g -->
    <script>
        let trp7g_init;
        createBase('trp7g','trp_story_7g','#c0f1c4',()=>{
            if(trp7g_init){return;}
            trp7g_init = true;
            
            let input = document.createElement('input');
            let input_changed = document.createElement('span');
            input.addEventListener('change',()=>{
                let str = '';
                for(let i = 0; i < input.value.length; i++){
                    let c = input.value.charCodeAt(i) - 1;
                    str += String.fromCharCode(c);
                }
                console.log(str);
                if(str === 'クリア' || str === 'くりあ' || str.toLowerCase() === 'clear'){
                    input_changed.textContent = 'クリア★';
                }else{
                    input_changed.textContent = str;
                }
            });
            let base = document.getElementById('trp7g_open');
            base.appendChild( input );
            base.appendChild( document.createElement('br') );
            base.appendChild( input_changed );
            base.appendChild( document.createElement('br') );

        } ,()=>{
        });
    </script>

    <br>

    <!-- trp7h -->
    <script>
        let trp7h_init = false;
        createBase('trp7h','trp_story_7h','#388dfc' ,()=>{
            if(trp7h_init){return;}
            trp7h_init = true;
            
            let clear = 'クリア';
            let game_end_msg = document.createElement('span');
            let base = document.getElementById('trp7h_open');
            let strings = ['はい','いいえ',clear];
            let space = document.createElement('span');
            space.textContent = '　';
            base.appendChild( space );

            for(let s of strings){
                let radio = document.createElement('input');
                radio.type = 'radio';
                radio.name = 'clear';
                if(s === clear){
                    radio.addEventListener('change',()=>{
                        game_end_msg.textContent = '　クリア★';
                    });
                }

                let span = document.createElement('span');
                span.textContent = s;
                base.appendChild( radio );
                base.appendChild( span );
            }
            
            base.appendChild( document.createElement('br') );
            base.appendChild( game_end_msg );
        } ,()=>{
        });
    </script>
    <br>

    <!-- trp7i -->
    <script>
        let trp7i_init = false;
        createBase('trp7i','trp_story_7i','#f13838',()=>{
            if(trp7i_init){return;}
            trp7i_init = true;

            let CLEAR = 
                [
                    '□█████□□█□□□█□□███████□□□□□□█□□□□',
                    '□█□□□█□□█□□□█□□□□□□□□█□□□□█████□□',
                    '█□□□□█□□█□□□█□□□□□█□□□□□█████████',
                    '□□□□□█□□□□□□█□□□□□█□□□□□□□█████□□',
                    '□□□□█□□□□□□□█□□□□□█□□□□□□□██□██□□',
                    '□□□█□□□□□□□█□□□□□█□□□□□□□□█□□□█□□',
                ];
            let EMPTY = '　';
            
            let block_area = document.createElement('div');
            let block_lines = [];
            let block_lines_str = [];
            let LINE_NUM = CLEAR.length;
            let LINE_LENGTH = CLEAR[0].length;
            let empty_str = (()=>{
                let s = '';
                for(let i = 0; i < LINE_LENGTH; i++){
                    s += EMPTY;
                }
                return s;
            })();
            for(let i = 0; i < LINE_NUM; i++){
                let line = document.createElement('span');
                block_lines_str.push( empty_str );
                line.textContent = block_lines_str[i];
                block_area.appendChild( line );
                block_area.appendChild( document.createElement('br') );

                block_lines.push( line );
            }

            let open = document.getElementById('trp7i_open');
            open.style.cursor = 'default';
            let say_clear = document.createElement('span');

            open.appendChild((()=>{
                function trp7i_set(x, y_before, y_now, y_end, block){
                    function trp7i_setInner(){
                        if(y_before !== -1){
                            let line = block_lines_str[y_before];
                            block_lines_str[y_before] = line.substring(0,x) +EMPTY+ line.substring(x+1,line.length);
                            block_lines[y_before].textContent = block_lines_str[y_before];
                        }
                        let line = block_lines_str[y_now];
                        block_lines_str[y_now] = line.substring(0,x) +block+ line.substring(x+1,line.length);
                        block_lines[y_now].textContent = block_lines_str[y_now];

                        if(y_now !== y_end){
                            y_before = y_now;
                            y_now++;
                            console.log(x+","+y_now);
                            setTimeout( trp7i_setInner ,50 );
                        }
                    }

                    trp7i_setInner();
                }

                let block_x = 0;
                let block_y = CLEAR.length - 1;
                let block_fall_num = 1;
                
                let btn = document.createElement('span');
                btn.textContent = '👺';
                btn.style.cursor = 'pointer';
                btn.addEventListener('click',()=>{
                    
                    for(let i = 0; i < Math.floor( block_fall_num ); i++){
                        if(block_y === -1){
                            say_clear.textContent = '＜クリア★';
                            return;
                        }
                        trp7i_set( block_x, -1, 0 ,block_y, CLEAR[block_y].substring(block_x,block_x+1) );

                        block_x++;
                        if(block_x === CLEAR[0].length){
                            block_x = 0;
                            block_y--;
                        }
                    }
                    
                    block_fall_num += 0.05;
                });
                return btn;
            })());
            open.appendChild( say_clear );
            open.appendChild( document.createElement('br') );
            open.appendChild( block_area );
        } ,()=>{});
    </script>

    <br>

    <!-- trp7j -->
    <script>
        let trp7j_init = false;
        createBase('trp7j','trp_story_7j','chartreuse',()=>{
            if(trp7j_init){return;}
            trp7j_init = true;

            let FIELD_W = 11;
            let FIELD_H = 4;
            let EMPTY = '　';
            let field = (()=>{
                let ret = [];
                for(let y = 0; y < FIELD_H; y++){
                    let arr = [];
                    for(let x = 0; x < FIELD_W; x++){
                        let elm = document.createElement('span');
                        elm.style.fontSize = '200%';
                        arr.push( elm );
                    }
                    
                    ret.push( arr );
                }
                return ret;
            })();
            let PLAYER_FACES = ['🍖','👺','💣','💰','🍙'];
            let player_face = PLAYER_FACES[0];
            let PLAYER_ACTION_STAND = 0;
            let PLAYER_ACTION_JUMP  = 1;
            let PLAYER_ACTION_FALL  = 2;
            
            let player_x = 0;
            let player_y = 0;
            let player_action = 0;
            
            let jump_count = 0;
            let draw_jump_count = document.createElement('span');
            let you_win = document.createElement('span');

            function reset(){
                player_x = Math.floor( FIELD_W / 2 );
                player_y = FIELD_H - 1;
            }

            function jump(){
                player_action = PLAYER_ACTION_JUMP;
                player_y--;
                update();
                if(player_y <= 0){
                    player_y = 0;
                    setTimeout( fall, 50 );
                    return;
                }

                setTimeout( jump, 50 );
            }

            function fall(){
                player_action = PLAYER_ACTION_FALL;
                player_y++;
                update();
                if(player_y >= field.length - 1){
                    player_y = field.length - 1;
                    player_action = PLAYER_ACTION_STAND;
                    return;
                }

                setTimeout( fall, 50 );
            }
            
            function update(){
                for(let y = 0; y < field.length; y++){
                    for(let x = 0; x < field[y].length; x++){
                        field[y][x].textContent = EMPTY;
                    }
                }
                field[player_y][player_x].textContent = player_face;

                draw_jump_count.textContent = 'ジャンプ回数:'+jump_count;
            }

            reset();
            update();
            
            let open = document.getElementById('trp7j_open');

            open.appendChild( draw_jump_count );
            open.appendChild( document.createElement('br') );

            open.appendChild((()=>{
                let ret = document.createElement('div');
                ret.addEventListener('click',()=>{
                    switch(player_action){
                        case PLAYER_ACTION_STAND :
                            jump_count++;
                            if(jump_count === 30){
                                you_win.textContent = 'クリア★';
                            }
                            jump();
                            break;
                        case PLAYER_ACTION_JUMP :
                            break;
                        case PLAYER_ACTION_FALL :
                            break;
                    }
                });

                for(let y = 0; y < field.length; y++){
                    for(let x = 0; x < field[y].length; x++){
                        ret.appendChild( field[y][x] );
                    }
                    ret.appendChild( document.createElement('br') );
                }
                return ret;
            })());               


            open.appendChild((()=>{
                let btn = document.createElement('button');
                btn.textContent = '肉選択';
                let index = 0;
                btn.addEventListener('click',()=>{
                    index = (index + 1) % PLAYER_FACES.length;
                    player_face = PLAYER_FACES[index];
                    update();
                });
                return btn;
            })());
            open.appendChild((()=>{
                let btn = document.createElement('button');
                btn.textContent = 'ステージ選択';
                btn.addEventListener('click',()=>{
                    let elm = document.getElementById('trp7j');
                    let rnd = ()=>Math.floor( Math.random() * 255 ).toString(16);
                    elm.style.backgroundColor = '#'+rnd()+rnd()+rnd();
                });
                return btn;
            })());
            open.appendChild( document.createElement('br') );
            open.appendChild( you_win );
        } ,()=>{});
    </script>

<br>

<!-- trp7k -->
<script>
{   
    let left = 50;
    let clear = document.createElement('div');
    clear.textContent = 'クリア★';
    clear.style.position = 'relative';
    clear.style.fontSize = '300%';
    let timer;

    function run(){
        clear.style.left = ''+left+'%';
        left += 0.8;
        if(left >= 100){
            left = -20;
        }

        timer = setTimeout( run, 25 );
    }

    createBase('trp7k','trp_story_7k','#986ddd',()=>{
        let open = document.getElementById('trp7k_open');
        open.appendChild( clear );
        open.style.overflow = 'hidden';
        run();
    },()=>{
        document.getElementById('trp7k_open').removeChild( clear );
        clearTimeout( timer );
    });
}
</script>

<br>

<!-- trp7l -->
<script>
{   
    const NUM = 50;
    let clears = [];
    let panel;
    let init = false;
    let timer;

    function createSpd(){
        return 0.4 + Math.random() * 2;
    }

    function setFontSize(element){
        let mul = 50 + Math.floor( Math.random() * 400 );
        element.style.fontSize = mul+'%';
    }

    function setColor(element){
        let rnd = ()=> (Math.floor( Math.random() * 255 )).toString(16);
        element.style.color = '#'+rnd()+rnd()+rnd();
    }

    function run(){
        clears.forEach(v=>{
            v.top += v.spd;
            if(v.top >= 120){
                v.top = -20;
                v.spd = createSpd();
                setFontSize( v.element );
            }
            v.element.style.top = v.top+'%';
            v.element.style.left = v.left+'%';
        });

        timer = setTimeout( run, 25 );
    }

    createBase('trp7l','trp_story_7l','#fbff14',()=>{
        if(!init){
            init = true;

            panel = document.createElement('div');

            for(let i = 0; i < NUM; i++){
                let elm = document.createElement('span');
                elm.textContent = 'クリア★';
                elm.style.position = 'fixed';
                
                let clear = {
                    element:elm,
                    left:(-20 + Math.random() * 120),
                    top:(-20 + Math.random() * 120),
                    spd:createSpd()
                };
                
                setFontSize(elm);
                setColor(elm);

                panel.appendChild( elm );
                clears.push( clear );
            }
        }
        document.body.appendChild( panel );

        run();
    },()=>{
        document.body.removeChild( panel );

        clearTimeout( timer );
    });
}
</script>

<br>

<!-- trp7m -->
<script>
{   
    let init = false;

    createBase('trp7m','trp_story_7m','#8f7278',()=>{
        if(init){return;}
        init = true;

        const URL_PRM = 'trp7m';
        const URL_VALUE = 'clear';
        
        let prm_is_clear = (()=>{
            let prms = location.search
                                .substring(1)//左端にある'?'を除外
                                .split('&');
            let ret = false;
            for(let i = 0; i < prms.length; i++){
                let set = prms[i].split('=');
                if(set[0] === URL_PRM && set[1] === URL_VALUE){
                    return true;
                }
            }
            return false;
        })();

        let open = document.getElementById('trp7m_open');
        open.style.textIndent = '1em';
        
        if(prm_is_clear){
            let clear = document.createElement('span');
            clear.textContent = 'クリア★';
            open.appendChild( clear );
        }else{
            let a = document.createElement('a');
            a.textContent = '👺';
            a.href = location.href+'?'+URL_PRM+'='+URL_VALUE;
            open.appendChild( a );
        }
    },()=>{});
}
</script>

<br>

<!-- trp7n -->
<script>
{   
    let init = false;
    let color = '#a19a9c';
    
    createBase('trp7n','trp_story_7n',color,()=>{
        if(init){return;}
        init = true;
        
        const NEST = 5;
        let arr = [];

        function f(num){
            const name = 'trp7n'+num;
            const title_name = 'trp_story_7n';

            let title = document.createElement('a');
            title.id = name+'_title';
            title.style = 'cursor:pointer; user-select:none;';
            title.textContent = '▼ '+title_name;
            
            let open = document.createElement('div');
            open.id = name+'_open';
            open.style = 'display:none; clear:both; cursor:pointer; user-select:none;';

            let init_done = false;

            title.addEventListener('click',function(){
                if(open.style.display === 'none'){
                    open.style.display = 'block';
                    title.textContent = '▲ '+title_name;
                    
                    if(!init_done){
                        init_done = true;
                        if(num === NEST - 1){
                            let clear = document.createElement('div');
                            clear.textContent = 'クリア★';
                            clear.style.textIndent = (num+2)+'em';
                            open.appendChild( clear );
                        }else{
                            open.appendChild( arr[num+1] );
                        }
                    }
                }else{
                    open.style.display = 'none';
                    title.textContent = '▼ '+title_name;
                }
            });

            let parent = document.createElement('div');
            parent.id = name;
            parent.style.backgroundColor = color;
            parent.style.textIndent = (num+1)+'em';
            parent.appendChild( title );
            parent.appendChild( open );
            
            return parent;
        }

        let open = document.getElementById('trp7n_open');
        for(let i = 0; i < 5; i++){
            arr.push( f(i) );
        }

        document.getElementById('trp7n_open').appendChild( arr[0] );
    },()=>{});
}
</script>

<br>

<!-- trp7o -->
<script>
{   
    let init = false;
    let panel = document.createElement('div');
    let clear = document.createElement('span');
        clear.textContent = 'クリア★';
        clear.style.position = 'fixed';
        clear.style.textAlign = 'center';
        clear.style.whiteSpace = 'nowrap';
    let size_zoom_spd;
    let size;
    let top;
    let left;
    let timer;

    function calcTop(){
        return window.innerHeight / 2 - size;
    }

    function run(){
        size += Math.floor( size_zoom_spd );
        size_zoom_spd -= 0.4;
        top = calcTop();
        left = left;

        clear.style.fontSize = size;
        clear.style.top = top+'px';
        clear.style.left = (left - clear.offsetWidth / 2)+'px';

        timer = setTimeout( run, 30 );
    }
    
    createBase('trp7o','trp_story_7o','#e4a289',()=>{
        {//init
            size_zoom_spd = 15;
            size = 1;
            top = calcTop();
            left = window.innerWidth / 2;
        }
        document.body.appendChild( clear );

        run();
    },()=>{
        document.body.removeChild( clear );

        clearTimeout( timer );
    });
}
</script>

<br>

<!-- trp7p -->
<script>
{   
    let init = false;
    let panel = document.createElement('div');
    let clear = document.createElement('span');
        clear.textContent = 'クリア★';
        clear.style.position = 'fixed';
        clear.style.textAlign = 'center';
        clear.style.whiteSpace = 'nowrap';
    let size;
    let top;
    let left;
    let timer;
    let zoom;
    let MIN_SIZE = 60;

    function calcTop(){
        return window.innerHeight / 2 - size;
    }

    function run(){
        let zoom_spd = 30;
        if(zoom){
            size += zoom_spd;
            if(clear.offsetWidth >= window.innerWidth){
                zoom = false;
            }
        }else{
            size -= zoom_spd;
            if(size <= MIN_SIZE){
                zoom = true;
            }
        }
        top = calcTop();
        left = left;

        clear.style.fontSize = size;
        clear.style.top = top+'px';
        clear.style.left = (left - clear.offsetWidth / 2)+'px';


        timer = setTimeout( run, 30 );
    }
    
    createBase('trp7p','trp_story_7p','#4bd5ff',()=>{
        {//init
            zoom = true;
            size = MIN_SIZE;
            top = calcTop();
            left = window.innerWidth / 2;
        }
        document.body.appendChild( clear );

        run();
    },()=>{
        document.body.removeChild( clear );

        clearTimeout( timer );
    });
}
</script>

<br>

<!-- trp7q -->
<script>
{   
    let init = false;
    let timer;
    let clear = document.createElement('div');
    let count = 0;
    let r_zoom = 0;
    let zooming = true;

    function run(){
        //shadow = 'xpx ypx ぼかし半径px rgba';

        let loop = 6;
        let r = 1;
        let shadow = '';
        
        shadow += '-4px -4px 4px rgba(255,200,100),';
        shadow += ' 4px -4px 4px rgba(255,200,100),';
        shadow += ' 4px  4px 4px rgba(255,200,100),';
        shadow += '-4px  4px 4px rgba(255,200,100),';

        for(let i2 = 0; i2 < 3; i2++){
            let _r = r * r_zoom;
            for(let i = 0; i < loop; i++){
                let rad = Math.PI * 2 * i / loop + count * 0.12;
                let x = Math.floor( Math.cos( rad ) * _r );
                let y = Math.floor( Math.sin( rad ) * _r );
                shadow += x+'px '+y+'px 20px rgba(255,255,255,0.8),';
            }

            r += 12;
        }

        for(let i = 0; i < 8; i++){
            let _r = 25;
            let rad = Math.PI * 2 * i / loop + count * 0.12;
            let x = Math.floor( Math.cos( rad ) * _r );
            let y = Math.floor( Math.sin( rad ) * _r );
            shadow += x+'px '+y+'px 20px rgba(255,255,255,0.8),';
        }


        if(zooming){
            r_zoom += 0.04;
            if(r_zoom >= 1){
                zooming = false;
            }
        }else{
            r_zoom -= 0.04;
            if(r_zoom <= 0.1){
                zooming = true;
            }
        }

        shadow = shadow.substr( 0, shadow.length - 1 );//最後の','を外す
        clear.style.textShadow = shadow;

        count ++;

        timer = setTimeout( run, 30 );
    }
    
    createBase('trp7q','trp_story_7q','#2b6c80',()=>{
        if(!init){
            init = true;
            
            clear.textContent = 'クリア★';
            clear.style.fontSize = '100px';
            clear.style.textAlign = 'center';
            clear.style.color = '#EEEEDD';
            
            document.getElementById('trp7q_open').appendChild(clear);
        }

        run();
    },()=>{
        clearTimeout( timer );
    });
}
</script>

<br>

<!-- trp7r -->
<script>
{   
    let init = false;
    let clear = document.createElement('div');
    
    createBase('trp7r','trp_story_7r','#8551ff',()=>{
        if(!init){
            init = true;
            
            clear.textContent = 'クリア★';
            clear.style.fontSize = '100px';
            clear.style.textAlign = 'center';
            clear.style.color = 'rgba(0,0,0,0)';
            
            clear.style.textShadow = '0px 0px 30px rgba(255,255,255,1)';
            
            document.getElementById('trp7r_open').appendChild(clear);
        }

    },()=>{
    });
}
</script>

<br>

<!-- trp7s -->
<script>
{   
    let init = false;
    let info;
    let choices;
    let CHOICE_MAX = 4;
    let before_choice;
    let dead_with_wakeup = false;
    let dead_with_sleep = false;
    const EMPTY_TEXT = '　';

    function clearChoices(){
        for(let i = 0; i < choices.length; i++){
            choices[i].textContent = EMPTY_TEXT;
            choices[i].onclick = ()=>{};
            choices[i].style.cursor = 'default';
            choices[i].style.textDecoration = 'none';
        }
    }

    function addChoice(text ,onclick){
        for(let i = 0; i < choices.length; i++){
            if(choices[i].textContent === EMPTY_TEXT){
                choices[i].textContent = '・'+text;
                choices[i].style.cursor = 'pointer';
                choices[i].style.textDecoration = 'underline';
                choices[i].onclick = ()=>{
                    before_choice.textContent = '＞'+text;
                    onclick();
                };
                break;
            }
        }
    }

    function setGameOver(info_text){
        clearChoices();

        info.textContent = info_text;
        addChoice('GameOver',()=>{
            info.textContent = EMPTY_TEXT;
            before_choice.textContent = EMPTY_TEXT;
            setChoices(0);
        });
    }

    function setChoices(phase){
        clearChoices();

        switch(phase){
            case 0:
                info.textContent = 'ベッドの上にいる。';
                addChoice('起き上がる' 
                    ,()=>{
                        dead_with_wakeup = true;
                        setGameOver('体力を使い切り死んだ。')
                    });
                addChoice('寝る' 
                    ,()=>{
                        dead_with_sleep = true;
                        setGameOver('二度と目を覚まさなかった。')
                    });
                if(dead_with_wakeup && dead_with_sleep){
                    addChoice('クリア' 
                        ,()=>{
                            clearChoices();
                            before_choice.textContent = EMPTY_TEXT;
                            info.textContent = 'クリア★';
                        });
                }
                break;
            default:
                info.textContent = '設定ミス:phase '+phase;
                addChoice( 'reset' ,()=>setChoices(0) );
                break;
        }
    }
    
    createBase2('trp7s','trp_story_7s','#d0ffd7',(open)=>{
        if(!init){
            init = true;
            
            before_choice = document.createElement('div');
            before_choice.textContent = EMPTY_TEXT;
            open.appendChild( before_choice );

            info = document.createElement('div');
            open.appendChild( info );

            choices = [];
            for(let i = 0; i < CHOICE_MAX; i++){
                choices.push( document.createElement('a') );


                let div = document.createElement('div');
                div.appendChild( choices[i] );
                open.appendChild( div );
            }

            setChoices(0);
        }
    },(open)=>{
    });
}
</script>

<br>

<!-- trp7t -->
<div style='color:rgba(0,0,0,0)'>クリア★</div>

<br>

<!-- trp8 -->
<script type="text/javascript" src="trp8.js"></script>

<br>

<!-- trp9 -->
<script type="text/javascript" src="trp9.js"></script>


<span style="color:#ff7268;"></span>

<br>
<br>
<br>
<br>
<br>
<br>
<br>


</body>

</html>